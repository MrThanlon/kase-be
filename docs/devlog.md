# Kase-be开发日志

## 2019-02-25

基本搞定短信相关的功能了，还需要新增验证码，防止爆破。不过我觉得这方面还是买DDoS高防比较好。

接下来主要的就是Excel文档解析，还有一级管理员的登录逻辑需要修改下，不太安全。

## 2019-02-24

关于表结构，有点麻烦，不是很好说明，基本上是怎么用到了就怎么来，有点随性。

为了应对登出以及修改密码等操作，ueser表新加一个version字段，当用户修改密码之后version+=1，同时在token中也新加一个version。因为逻辑上的原因，为了减少性能损失，我把version的检测放到`jwt_decode`函数中，也就是说`jwt_check`只会验证签名而不会检测version。

## 2019-02-12

产品说做成第一种。

同时评审员账户也是，评审员账户可以加入多个项目。现在建立了几个这样的映射表，当然是用来映射各个关系的了。比如

- `content-group`->材料与组的映射
- `user-group`->评审员与组的映射
- `user-project`->评审员与项目的映射

当把评审员加入到组或者项目的时候就加一条记录（反之删除则去除一条记录），材料同理。

然后说下评分，评分也是单独的一个表，存储的其实是评分记录，算总分的时候查询一次就行。

关于文件的存储，我是直接扔一个目录了，xxxp的是pdf，xxxz的是附件。文件原名存储在数据库`content`表。

评审人员的打分表那一块，涉及到Excel文件的处理，先缓一缓吧。

## 2019-01-26

新开了这个文件专门用来水。

思绪很乱，这个评审系统感觉并不像之前想象的那样简单。逻辑还是挺复杂的，做数据库的结构的时候就感觉到了。

从评审材料的层次，大概可以分三个层面

- 单个评审材料
- 项目分区（或者叫材料组）
- 项目

最底层的不用说，就是评审的材料。

项目分区的意义在于在某个项目下，要给评审人员安排不同的评审材料去评审。有两个思路

- 把某个评审员要评审的材料的id存到对应评审员的那条记录里面，但是这样可能会导致查询速度比较慢，但是比较灵活。
- 做成分区，材料分开，评审员分开，评审员/材料在一个分区的就评审，不在的就不评审。这样就多加了一个层次（项目分区），但是性能应该会比上面那个好，而且逻辑比较清晰。

个人感觉两者在实现上都不简单，但是第二个的话性能应该挺不错？先听下产品怎么说吧。